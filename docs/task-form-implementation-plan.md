# タスク追加フォーム実装計画

## 概要

タスクを追加するためのフォームを実装します。フォームは shadcn/ui のコンポーネントを使用し、TanStack Form と Valibot による型安全なフォーム実装を行います。

## 実装するコンポーネントと機能

### 1. `TaskForm` コンポーネント

#### 基本機能
- タイトル（必須）
- 説明（任意）
- ステータス選択
- 優先度選択
- 期限設定（任意）
- タグ入力（任意）

#### UI コンポーネント
- Form (@shadcn/ui)
- Input (@shadcn/ui)
- Textarea (@shadcn/ui)
- Select (@shadcn/ui)
- DatePicker (@shadcn/ui)
- Button (@shadcn/ui)

### 2. `useCreateTask` カスタムフック

- TanStack Query の useMutation を使用
- `/api/tasks` へのPOSTリクエスト
- 楽観的更新の実装
- エラーハンドリング

## 実装ステップ

1. **タスク作成用のカスタムフック実装**
   - `src/entities/task/api/useCreateTask.ts` の作成
   - エラーハンドリングの実装
   - キャッシュの更新処理

2. **フォームコンポーネントの実装**
   - `src/entities/task/ui/task-form.tsx` の作成
   - TanStack Form と Valibot によるバリデーション
   - UI コンポーネントの統合

3. **タスク一覧画面への統合**
   - フォームのモーダル表示
   - 成功・エラー時のフィードバック
   - タスク一覧の自動更新

## バリデーションルール

- タイトル：1-100文字
- 説明：0-1000文字（任意）
- ステータス：'todo'、'in_progress'、'done' のいずれか
- 優先度：'low'、'medium'、'high' のいずれか
- 期限：未来の日付のみ許可（任意）
- タグ：文字列の配列（任意）

## エラーハンドリング

1. **フォームレベルのエラー**
   - 必須フィールドの検証
   - 文字数制限の検証
   - 日付の検証

2. **APIレベルのエラー**
   - ネットワークエラー
   - サーバーエラー
   - バリデーションエラー

## テスト計画

1. **ユニットテスト**
   - バリデーションロジック
   - フォームの状態管理
   - エラーハンドリング

2. **統合テスト**
   - フォームの送信
   - APIとの連携
   - キャッシュの更新

3. **E2Eテスト**
   - フォームの入力から送信まで
   - エラー時の挙動
   - 成功時のフィードバック

## 実装の注意点

1. **アクセシビリティ**
   - 適切なラベルとaria属性の使用
   - キーボード操作のサポート
   - エラーメッセージの適切な提示

2. **パフォーマンス**
   - フォームの最適化
   - 適切なキャッシュ戦略
   - 楽観的更新の実装

3. **UX**
   - 直感的なフォームレイアウト
   - 適切なフィードバック
   - ローディング状態の表示

## 技術スタック

- TanStack Form: フォーム状態管理
- TanStack Query: サーバー状態管理
- Valibot: バリデーション
- shadcn/ui: UIコンポーネント
- MSW: APIモック

## 今後の拡張性

1. **機能拡張**
   - サブタスクのサポート
   - 定期タスクのサポート
   - ファイル添付機能

2. **UI/UX改善**
   - ドラッグ&ドロップによるタグ管理
   - リッチテキストエディタの統合
   - タスクテンプレートの保存